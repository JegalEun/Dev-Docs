# ✏️ 프로세스와 스레드

## 프로그램 (Program)
먼저 프로세스와 스레드에 대해 이해하기 전에 프로그램이라는 것도 알고 가자!
> 프로그램이란, 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가 있지 않은 **정적인 상태**를 말한다.

쉽게 말하면 프로그램은 아직 실행이 되지 않은 파일 그자체를 의미한다. 프로그램을 실행하게 되면 운영체제가 메모리 공간을 할당해주고 할당된 메모리에 적재된다. 이 상태를 **동적인 상태**라고 한다.
하지만 프로그램은 메모리에 적재되기 전인 정적인 상태를 말한다. 

## 프로세스 (Process)
프로세스는 **실행 중인 프로그램**으로 디스크로부터 **메모리에 적재**되어 CPU의 할당을 받을 수 있는 것을 말한다.
> 운영체제의 최소 작업 단위

프로그램을 실행하여 메모리 적재가 되면 **동적인 상태**라고 하며 이 프로그램을 **프로세스**라고 한다.

<img width="606" alt="프로그램과 프로세스" src="https://user-images.githubusercontent.com/43868540/145769507-0e3ffdcb-9402-4052-b621-34632978fda5.png">
> [출처 raejoonee](https://velog.io/@raejoonee/프로세스와-스레드의-차이)

## 스레드 (Thread)

과거에는 프로그램을 실행할 때 실행 끝까지 프로세스 '하나'만 사용했다고한다. 시간이 흐를수록 프로그램이 복잡해지고 프로세스 하나만을 이용해서 프로그램을 실행하기에는 벅차게 되었다.

하지만 한 프로그램을 처리하기 위해서 여러 개의 프로세스를 만들기에는 불가능했다. 그 이유는 운영체제는 안전성을 위해서 프로세스마다 자신에게 할당된 메모리 내의 정보만 접근할 수 있도록 제약을 두었기 때문이다. 그래서 프로세스보다 더 작은 실행 단위 개념이 필요했고 이것이 스레드이다.다.
> CPU의 최소 작업 단위

<img width="589" alt="스레드" src="https://user-images.githubusercontent.com/43868540/145787953-cff5d668-de15-4090-98b4-4e51160e8b9d.png">
> [출처 raejoonee](https://velog.io/@raejoonee/프로세스와-스레드의-차이)

스레드는 **프로세스의 한계를 해결**하기 위해 만들어진 개념이다. 스레드는 스레드 간 메모리를 공유하며 작동한다. 스레드끼리 프로세스의 자원을 공유하면서 프로세스 실행 흐름의 일부가 되는 것이다. 

하지만 스레드만의 단점이 있다. 만약, 어떤 스레드 하나에서 오류가 발생했다면 같은 프로세스 내의 다른 스레드가 모두 강제로 종료된다. 즉, 영향을 받는다는 것이다.
하지만 프로세스는 하나의 프로세스가 오류가 발생한다면 다른 프로세스는 영향이 없다. 메모리를 공유하고 있지 않기때문이다.

### 멀티태스킹, 멀티스레드
멀티태스킹이란 하나의 **운영체제** 안에서 여러 프로세스가 실행되는 것을 의미한다. 멀티태스킹은 

멀티스레드란 하나의 **프로세스** 안에서 여러 스레드가 실행되어 동시에 처리하는 것을 의미한다. 
- 여러 스레드가 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 향상시킨다.
- 하나의 프로그램이 동시에 여러 개의 일을 수행할 수 있도록 해주는 것이다.

### 멀티스레드의 장점
- 메모리를 공유하고 있어 메모리 자원을 아낄 수 있다.
- 스레드는 프로세스 내의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 응답 시간이 빠르다.

### 멀티스레드의 단점
- 스레드 하나가 프로세스 내 자원을 망쳐버린다면 모든 프로세스가 종료될 수 있다.
- 자원을 공유하고 있기 때문에 **동기화**가 필수적이다.

### 동기화
멀티스레드를 사용하면 각각의 스레드 중 어떤 순서로 실행될 지 그 순서를 알 수 없다. 또한, 여러 스레드가 동일한 메모리(Data 영역과 Heap 영역)를 공유하고 있기 때문에 자원이 충돌한다.

이때 해주는 작업이 `동기화 작업`이다.

동기화는 스레드들에게 하나의 자원에 대한 처리 권한을 주거나 순서를 조정해주는 기법이다. 동기화를 통해 작업 처리 순서를 제어하고 공유 자원에 대한 접근을 제어하는 것이다.
하지만 불필요한 부분까지 `락(lock)`을 해준다면 병목현상이 발생하여 성능이 저하될 가능성이 높다. 
> 병목현상이란 어떤 시스템 내 데이터 처리 속도가 지연됨에 의해서 다음에 오는 데이터 처리가 지연되는 현상

따라서 공유 자원인 부분만 동기화가 필요하다. 이때 `synchronized`키워드를 통해 실현한다. 

동기화에 대한 자세한 설명은 다음에 임계영역과 함께 설명을 하면서 정리하겠다.

## 결론
- 프로세스와 스레드는 개념의 범위부터 다르며 제어를 받는 주체가 다르다.
- 프로세스는 운영체제의 실행단위이고 스레드는 CPU의 실행단위이다. 
- 프로세스는 Code/Data/Stack/Head 메모리 영역을 할당해주고 스레드는 프로세스 내에서 Stack 영역을 제외한 다른 Data/Heap 영역을 다른 스레드와 공유한다.
- 스레드는 같은 프로세스 내에서 공유 메모리를 공유하기 때문에 불필요한 메모리를 줄여 성능이 향상되고 통신이 빠르다.
- 스레드는 동기화 문제를 해결해야한다.

----
#### Reference
- [프로세스와 스레드의 차이](https://velog.io/@raejoonee/프로세스와-스레드의-차이)
- [멀티 스레드](https://woovictory.github.io/2018/12/26/OS-MultiThread-Concept/)