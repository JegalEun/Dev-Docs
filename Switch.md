네트워크 교육을 듣다가 스위치가 L1, L2, L3, L4, L7 계층별로 각각 존재한다는 것을 알게되었고 더욱 자세히 알고 싶어 정리를 해보았다.

# 스위치(Switch)
스위치란 허브의 확장된 개념으로 기본 기능은 허브와 동일하지만 전송 중 패킷의 충돌이 일어나지 않도록 패킷의 목적지로 지정할 포트를 직접 전송한다. 소규모 통신을 위한 허브보다 전송 속도가 개선된 것이다. 

간단하게 말해서 아래의 사진처럼 인터넷을 할 수 있는 랜선을 꽂을 수 있는 것을 스위치라고 한다. 하나의 네트워크 라인에 여러 대의 컴퓨터로 네트워크를 연결하기 위해 필요한 장치이다.  
![스위치](https://user-images.githubusercontent.com/43868540/104828040-9c99b080-58a8-11eb-8c1b-19e30b8ab9d8.PNG)

> [출처](https://nhj12311.tistory.com/75)

스위치에서 패킷의 목적지 주소를 기준으로 보내는 곳과 받는 곳을 계산하여 해당 포트로 1대1 연결한다. 이것을 스위칭(Switching)이라고 한다.
스위칭은 정보 전달의 수단과 회선의 효율적 운용을 위해 입/출력 상태를 감시하며 전송로의 장애 발생 시 현재 상태에서 예비 상태로 전환한다. 

## 허브와 스위치의 차이
허브의 경우 전송대역을 여러 대의 네트워크가 나눠 쓰는 단점이 있다. 반면 스위치의 경우는 같은 속도로 분배해준다는 장점이 있다.

![스위치와 허브](https://user-images.githubusercontent.com/43868540/104828795-5cd6c700-58b0-11eb-9c5c-c18f53c02339.PNG)

> [출처](https://siran.tistory.com/205)

위에 그림을 보면 허브는 모든 노드가 일정 속도를 나눠쓰게 되고, 스위치는 네트워크를 동시에 사용가능해 속도저하가 거의 없다. 따라서 스위치는 bandwidth가 설정되어 있다. 

## 스위치의 특징
- 패킷을 보내는 노드와 받는 노드를 1대1로 연결해 주기 때문에 충돌이 발생하지 않고 빠른 속도로 전송이 가능하다.
- 두 개의 노드가 통신을 하는 동안 다른 노드들도 서로간의 통신이 동시에 가능하며 이더넷에서 높은 효율을 갖는다.
- 노드의 수가 증가해도 속도의 저하가 일어나지 않으며 패킷의 감청이 어려운 구조이므로 보안성이 높다.

### 더미허브
허브는 모든 랜선에 꽂힌 포트에 동일한 정보를 보내는 장비이다. 모든 포트에게 정보를 보내는 만큼 네트워크에 연결된 PC, 링크 수가 많을 수록 속도가 느려지고 패킷 충돌이 날 가능성이 높다. OSI 7계층 중에 1계층인 물리계층을 이용하기때문에 L1스위치라고 부르기도 하고, 더미허브라고도 부른다.

### Layer2 스위치(스위치)
스위치 패킷이 왔을때 그것의 목적지가 어디인지를 보고 그 목적지로 보내주는 역할만 한다. 더미허브와는 다르게, 포트 하나하나 찾아가 데이터를 전달하는 역할을 하기때문에 속도에 저하가 없다. 

- 가장 흔히 볼 수 있는 스위칭 방식이며, 원래 스위치의 정의에 가장 부합하는 형태이다. 
- 패킷의 **MAC 주소**를 읽어 스위칭을 하고, MAC의 OSI 계층 중 2계층에 해당하기 때문에 Layer2 스위치라 한다. 
- 스위칭 허브는 모든 자료를 보내는 곳으로 수신 번지를 전송한다. 
- Broadcast 패킷에 의해 성능 저하가 발생한다. 
> Broadcast란 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식이다.

하지만 L2 스위치는 ethernet 레벨에서 동작할 뿐 상위 레이어인 network layer인 3계층에서 동작하는 ip 등을 이해하지못한다. 따라서 라우팅이 불가능하다. 

### Layer3 스위치(라우터)
L2와는 달리 L3는 IP 주소까지 알고 있기때문에 외부에 연결된 포트도 데이터를 보낼 수 있다.
자신에게 온 패킷의 Destination이 외부에 존재하는 IP일 경우 그 패킷을 외부에 연결된 라우터로 보내줄 수 있다 라우터 기능도 가지고 있어서 라우터와의 경계가 모호하다. 

- 패킷의 **IP 주소**를 읽어 스위칭을 하고, IP가 OSI 7계층 중 3계층에 해당하기 때문에 Layer 3 스위치라 한다. 
- L2 스위치에 라우팅(Routing) 기능을 추가하고 TCP/IP를 이용한다.

### Layer4 스위치(로드밸런싱)
L4 스위치는 TCP/UDP 프로토콜에서 스위칭을 수행하므로 TCP와 UDP의 포트를 보고 적절한 서버로 패킷을 전송한다. 즉 똑같은 IP여도 포트번호가 다를 경우 다른 서버로 보낼 수 있다. 
TCP와 UPD등의 헤더를 보고 그것이 FTP인가 HTTP인가 SMTP인가를 보고 어떤 것을 우선시 해서 스위칭할 지 판단할 수 있다. 또한, 서버나 네트워크의 트래픽을 로드밸런싱 해줄 수 있는 스위치이다. 
> 로드밸런싱은 여러대의 서버를 1대처럼 묶을 수 있는 분산기능이다.

실제로 많은 온라인 서비스들은 대부분 최소 2개 이상의 같은 서버들로 분산처리 되게끔 구성되어있다고 한다. 이때 서비스를 분산시켜주는 장비가 L4 즉, 로드밸런싱을 이용한다. 이는 부하를 분산하기 위함도 있고 서비스가 죽는 경우에 대비하기 위한 것이다.

![L4](https://user-images.githubusercontent.com/43868540/104828573-3ca60880-58ae-11eb-8ba1-5e98db78c670.PNG)

> [출처](https://klero.tistory.com/entry/L2-L3-L4-L7-%EC%8A%A4%EC%9C%84%EC%B9%98-%EA%B5%AC%EB%B6%84-%EB%B0%8F-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-%EC%84%A4%EB%AA%85)

- 패킷의 IP주소와 Port번호를 읽어 스위칭을 하고 Port가 OSI 7계층 중 4계층에 해당하기 때문에 Layer 4 스위치라 한다. 
- L3와 같이 프로토콜을 기반으로 하며, 어플리케이션별로 우선 순위를 두어 스위칭이 가능하다.
- 많은 양의 트래픽을 여러 서버로 분산 가능하다.


## 정리
각 어떤 계층에서 수행되는가에 따라 L2, L3 등 분류된다.
상위 레벨에서 동작하는 스위치는 자신의 하위 레벨 스위치의 기능을 다 갖고 있다. 예를 들어 L4 스위치는 L3, L2 기능도 다 수행할 수 있다.

L2 스위치는 MAC 정보(MAC Table)를 보고 스위칭을 하는 것이고,(일반적인 스위치의 기능)

L3 스위치는 IP 정보(Routing Table)를 보고 스위칭을 하는 것이고,(라우팅 기능이 추가됨)

L4 스위치는 IP+Port(Session or Connection)를 보고 스위칭을 하는 것이며,(로드밸런싱을 위해 사용됨) 

----
#### Reference
- [스위치와 L2,L3,L4](https://startingpitcher.tistory.com/8)
- [L1,2,3,4,7]ttps://nhj12311.tistory.com/75)
