이번 시간에는 TCP 통신에서 쓰이는 `3-way handShaking`과 `4-way handShaking`을 배우는 시간을 가질 것이다.

TCP의 개념과 특징을 이해한 다음 `3-way handShaking`과 `4-way handShaking`의 개념을 살펴보도록 하자.

# TCP
TCP는 OSI 7계층 중 전송 계층에서 사용하는 프로콜로서, 장치들 사이에 논리적인 접속을 성립하기 위하여 연결을 설정하여 **신뢰성을 보장**하는 연결형 서비스이다.
> OSI 7계층에 대한 설명은 [이곳](https://github.com/im-d-team/Dev-Docs/blob/master/Network/OSI7%20Layer.md)을 참고하길 바란다.

## TCP의 특징
- 인터넷 상에서 데이터를 메시지의 형태로 보내기 위해 `IP`와 함께 사용하는 프로토콜이다.
- 연결형 서비스로 가상 회선 방식을 제공한다.
> 연결형 서비스란 `3-way handShaking`과정을 통해 연결을 설정하고, `4-way handShaking`을 통해 연결을 해제하는 것을 의미한다.
- 흐름제어 및 혼잡제어를 제공한다.
> 흐름제어란 송신하는 곳과 수신하는 곳의 데이터 처리속도 조절하는 것이고 혼잡제어는 네트워크 내의 패킷 수가 넘치게 증가하지 않도록 방지하는 것을 의미한다. 
- 높은 신뢰성을 보장한다,
- UDP보다 속도가 느리다.
- 전이중(Full-Duplex), 점대점 방식(Point to Point)이다.
> 전이중이란 전송이 양방향으로 동시에 일어날 수 있는 것을 의미하고, 점대점은 각 연결이 정확히 2개의 종단점을 가지고 있는 것을 의미한다.
- 연속성보다 신뢰성있는 전송이 중요할 때에 사용된다.

## TCP의 연결설정 및 해제 과정
TCP 통신을 이용하여 데이터를 전송하기 위해서는 네트워크 연결을 설정하는 과정이 필수적이다. 네트워크 연결을 하기위해서 TCP는 `3-way handShaking`이라는 과정을 거친다.

### 3-way handShaking
`3-way handShaking`이란 `TCP/IP` 프로토콜을 이용해서 통신을 하는 응용 프로그램이 데이터를 전송하기 전에 먼저 정확한 전송을 보장하기 위해 상대방 컴퓨터와 사전에 세션을 수립하는 과정을 의미한다. 

사전에 세션을 수립함으로써 양쪽 모두 데이터를 전송할 준비가 되었다는 것을 보장하고, 실제로 데이터 전달이 시작하기 전에 한 쪽이 다른 쪽이 준비되었다는 것을 알 수 있도록 하여 논리적인 접속을 성립한다.

1. 클라이언트가 서버에게 연결 요청 메시지를 전송한다. (SYN)
2. 메시지를 수신한 서버는 요청을 수락하며 클라이언트에게 포트를 열어달라는 메시지도 전송한다. (SYN+ACK)
3. 서버가 요청을 수락했다는 메시지를 받은 클라이언트가 수락 확인을 보내 연결을 맺는다. (ACK)
> SYN(Synchronization) : 연결요청, 세션을 설정하는데 사용되며 시퀀스 번호를 보냄
> ACK(Acknowledgemnet) : 보낸 시퀀스 번호에 TCP 계층에서의 길이 또는 양을 더한 것과 같은 값을 ACK에 포함하여 전송

### 4-way handshaking
TCP 연결을 하였다면 연결해지하기 위해 `4-way handshaking`이라는 과정을 거친다.

1. 클라이언트가 연결을 종료하겠다는 메시지를 전송한다 (FIN)
2. 서버는 클라이언트의 메시지를 받고 확인 메시지를 전송한다 (ACK)
2-1. 데이터를 모두 보낼 때까지 잠깐 TIME_OUT이 된다.
3. 데이터를 모두 보내고 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 메시지 전송한다. (FIN)
4. 클라이언트는 서버의 메시지를 확인했다는 메시지를 보낸다 (ACK)
5. 서버는 클라이언트의 확인 메시지를 받고 소켓 연결을 close한다.
6. 클라이언트는 아직 서버로부터 받지 못한 데이터가 있을 것을 대비해 일정 시간 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거친다. (TIME_WAIT)

----
#### Reference
- [3-way handshaking & 4-way handshaking](https://k39335.tistory.com/21?category=653558)

